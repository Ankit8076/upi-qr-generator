<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UPI Link & QR Generator</title>
  <!-- QRCode.js (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body{font-family:system-ui,arial;padding:24px;max-width:720px;margin:auto}
    label{display:block;margin:10px 0 6px}
    input, textarea, select{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc}
    button{padding:12px 16px;border:0;border-radius:12px;cursor:pointer;margin-top:14px;background:#2563eb;color:white}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .card{border:1px solid #eee;border-radius:16px;padding:16px;margin-top:20px;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
    #qrcode{display:flex;justify-content:center;align-items:center;min-height:220px}
    .mono{font-family:ui-monospace, Menlo, Monaco, Consolas, monospace}
  </style>
</head>
<body>
  <h1>UPI Payment Link & QR Generator</h1>
  <p>Details भरो → <em>Generate</em> दबाओ → UPI link और QR मिल जाएगा।</p>

  <div class="card">
    <div class="row">
      <div>
        <label>Payee UPI ID (pa)</label>
        <input id="pa" placeholder="jaise: merchant@upi" />
      </div>
      <div>
        <label>Payee Name (pn)</label>
        <input id="pn" placeholder="jaise: ACME Store" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Amount (am) — INR</label>
        <input id="am" type="number" step="0.01" placeholder="jaise: 199.00" />
      </div>
      <div>
        <label>Transaction Note (tn)</label>
        <input id="tn" maxlength="80" placeholder="jaise: Order #1234" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Transaction Ref (tr) — optional</label>
        <input id="tr" placeholder="unique ref (optional)" />
      </div>
      <div>
        <label>Minimum Amount Lock?</label>
        <select id="mam">
          <option value="">No</option>
          <option value="1">Yes (lock amount)</option>
        </select>
      </div>
    </div>

    <button id="gen">Generate UPI Link & QR</button>
  </div>

  <div class="card">
    <h3>UPI Deep Link</h3>
    <div class="mono" id="linkBox" style="word-break:break-all;"></div>
    <button id="copy" style="display:none">Copy Link</button>
  </div>

  <div class="card">
    <h3>QR Code</h3>
    <div id="qrcode"></div>
    <a id="download" download="upi-qr.png" style="display:none;margin-top:10px">Download QR</a>
  </div>

  <script>
    const el = id => document.getElementById(id);

    function buildUpiLink({pa,pn,am,tn,tr,mam}){
      if(!pa) throw new Error("UPI ID (pa) required");
      const params = new URLSearchParams();
      params.set("pa", pa);
      if(pn) params.set("pn", pn);
      if(am) params.set("am", Number(am).toFixed(2));
      if(tn) params.set("tn", tn);
      if(tr) params.set("tr", tr);
      if(mam) params.set("mam", mam);
      params.set("cu", "INR");
      return `upi://pay?${params.toString()}`;
    }

    let qr;
    el("gen").onclick = () => {
      try {
        const link = buildUpiLink({
          pa: el("pa").value,
          pn: el("pn").value,
          am: el("am").value,
          tn: el("tn").value,
          tr: el("tr").value,
          mam: el("mam").value
        });

        el("linkBox").textContent = link;
        el("copy").style.display = "inline-block";
        if(qr){ el("qrcode").innerHTML=""; }

        qr = new QRCode(el("qrcode"), {
          text: link,
          width: 256,
          height: 256,
          correctLevel: QRCode.CorrectLevel.M
        });

        setTimeout(()=>{
          const canvas = el("qrcode").querySelector("canvas");
          if(canvas){
            const dataURL = canvas.toDataURL("image/png");
            const dl = el("download");
            dl.href = dataURL;
            dl.style.display = "inline-block";
          }
        }, 300);

      } catch(e){
        alert(e.message);
      }
    };

    el("copy").onclick = async () => {
      const text = el("linkBox").textContent;
      try {
        await navigator.clipboard.writeText(text);
        el("copy").textContent = "Copied!";
        setTimeout(()=> el("copy").textContent = "Copy Link", 1200);
      } catch {
        alert("Copy failed — manually copy kar lein.");
      }
    };
  </script>
</body>
</html>
